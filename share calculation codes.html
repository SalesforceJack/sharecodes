<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OrtaklÄ±k KÃ¢r ve Kredi DaÄŸÄ±tÄ±m Hesaplama</title>
    <style>
        /* CSS Stilleri */
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f9; color: #333; }
        h1, h2, h3 { color: #1565c0; }
        .input-group { margin-bottom: 20px; padding: 15px; border: 1px solid #ccc; border-radius: 8px; background-color: #fff; }
        .input-group label { display: inline-block; width: 250px; font-weight: bold; }
        .input-group input { padding: 8px; width: 200px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 12px 25px; cursor: pointer; background-color: #1565c0; color: white; border: none; border-radius: 4px; margin-top: 15px; font-size: 16px; transition: background-color 0.3s; }
        button:hover { background-color: #0d47a1; }
        
        .results-table { width: 100%; border-collapse: collapse; margin-top: 25px; font-size: 0.9em; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .results-table th, .results-table td { border: 1px solid #e0e0e0; padding: 10px; text-align: right; }
        .results-table th { background-color: #e3f2fd; color: #1565c0; text-align: center; font-weight: bold; }
        .results-table tbody tr:nth-child(even) { background-color: #f9f9f9; }
        .results-table tfoot td { font-weight: bold; background-color: #bbdefb; color: #0d47a1; font-size: 1.1em; }
        .net-cash-flow { background-color: #e8f5e9; font-weight: bold; }
        .loan { color: red; }
        .error { color: #d32f2f; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>OrtaklÄ±k KÃ¢r ve Kredi DaÄŸÄ±tÄ±mÄ± HesaplayÄ±cÄ± ğŸ’µ</h1>

    <div class="input-group">
        <label for="dukkanEBITDA">YÄ±llÄ±k BaÅŸlangÄ±Ã§ Net KÃ¢rÄ± (USD) ğŸ“ˆ:</label>
        <input type="text" id="dukkanEBITDA" value="100000" placeholder="Ã–rn: 100000">
    </div>

    <div class="input-group">
        <label for="loanAmount">Toplam Kredi TutarÄ± (USD) ğŸ¦:</label>
        <input type="text" id="loanAmount" value="300000" placeholder="Ã–rn: 300000">
    </div>

    <div class="input-group">
        <label for="loanTermMonths">Kredi Vadesi (Ay) / Analiz SÃ¼resi ğŸ—“ï¸:</label>
        <input type="number" id="loanTermMonths" value="84" min="12" placeholder="Ã–rn: 36 (3 yÄ±l)">
        <p style="font-size: 0.8em; color: #555;">(36 yazarsanÄ±z 3 yÄ±llÄ±k kar daÄŸÄ±tÄ±mÄ± ve satÄ±ÅŸ hesaplanÄ±r.)</p>
    </div>
    
    <button onclick="calculateProfitDistribution()">Kredi Vadesine GÃ¶re Net KazancÄ± Hesapla</button>
    
    <hr>
    
    <div id="results">
        </div>
<script>
// Function to calculate the monthly payment for a loan
function calculateMonthlyPayment(principal, annualRate, months) {
    const monthlyRate = annualRate / 12 / 100;
    const numberOfPayments = months;

    if (monthlyRate === 0 || numberOfPayments === 0) {
        return principal / 1; 
    }

    // Mortgage Formula: M = P [ i(1 + i)^n ] / [ (1 + i)^n â€“ 1]
    const monthlyPayment = principal * (monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments)) / (Math.pow(1 + monthlyRate, numberOfPayments) - 1);
    
    return monthlyPayment;
}

function calculateProfitDistribution() {
    // 1. Girdi DeÄŸerlerini Al
    const dukkanEBITDAInput = document.getElementById('dukkanEBITDA').value;
    const loanAmountInput = document.getElementById('loanAmount').value;
    const loanTermMonthsInput = document.getElementById('loanTermMonths').value; 

    // GiriÅŸ formatÄ± dÃ¼zeltmesi: VirgÃ¼lleri kaldÄ±rÄ±r
    const initialAnnualNetProfit = parseFloat(dukkanEBITDAInput.replace(/,/g, '')); 
    const totalLoanPrincipal = parseFloat(loanAmountInput.replace(/,/g, ''));
    const loanTermMonths = parseInt(loanTermMonthsInput); 
    
    // Analiz sÃ¼resi: Kredi vadesine eÅŸitlenir. Ay sayÄ±sÄ± yÄ±l sayÄ±sÄ±na Ã§evrilir ve yukarÄ± yuvarlanÄ±r.
    const NUM_YEARS_OF_ANALYSIS = Math.ceil(loanTermMonths / 12); 

    // Sabitler
    const APR = 10; 
    const ANNUAL_GROWTH_RATE = 0.05; 
    const EXIT_MULTIPLIER = 3; 
    
    const PARTNER_1_OWNERSHIP = 0.50; 
    const PARTNER_2_OWNERSHIP = 0.25; 
    const PARTNER_3_OWNERSHIP = 0.25; 
    
    if (isNaN(initialAnnualNetProfit) || initialAnnualNetProfit <= 0 || 
        isNaN(totalLoanPrincipal) || totalLoanPrincipal < 0 || 
        isNaN(loanTermMonths) || loanTermMonths <= 0) {
        document.getElementById('results').innerHTML = '<p class="error">LÃ¼tfen geÃ§erli kÃ¢r, kredi miktarÄ± ve ay sayÄ±sÄ± girin.</p>';
        return;
    }

    // --- KÃ¢r DaÄŸÄ±tÄ±m KurallarÄ± ---
    const OPERATOR_DIRECT_FRACTION = 1 / 3; 
    const REMAINDER_PARTNER_1_SHARE = 0.50; 
    const REMAINDER_OTHER_PARTNERS_SHARE = 0.50; 

    // 2. Kredi Amortisman Tablosu oluÅŸturulur (TÃ¼m kredi vadesi boyunca)
    const monthlyLoanPayment = calculateMonthlyPayment(totalLoanPrincipal, APR, loanTermMonths);
    let loanBalance = totalLoanPrincipal;
    let amortizationSchedule = [];

    // Kredi vadesinin tamamÄ± boyunca aylÄ±k Ã¶demeler hesaplanÄ±r.
    const maxMonthsToAnalyze = loanTermMonths; 

    for (let month = 1; month <= maxMonthsToAnalyze; month++) {
        if (loanBalance <= 0) break;

        const monthlyRate = APR / 12 / 100;
        const interestPayment = loanBalance * monthlyRate;
        
        let principalPayment = monthlyLoanPayment - interestPayment;
        let payment = monthlyLoanPayment;

        if (principalPayment > loanBalance) {
            principalPayment = loanBalance;
            payment = interestPayment + principalPayment;
            loanBalance = 0;
        } else {
             loanBalance = loanBalance - principalPayment;
        }
        
        const year = Math.ceil(month / 12); // Hangi yÄ±la ait olduÄŸunu bul

        // YÄ±llÄ±k verileri toplamak iÃ§in kontrol
        if (!amortizationSchedule[year]) {
            amortizationSchedule[year] = { year: year, totalPayment: 0, endingBalance: 0 };
        }
        
        amortizationSchedule[year].totalPayment += payment;
        amortizationSchedule[year].endingBalance = loanBalance;
    }
    
    // 3. KÃ¢r ve Kredi DaÄŸÄ±tÄ±mÄ± (YÄ±llÄ±k DÃ¶ngÃ¼)

    let htmlOutput = `
        <h2>ğŸ’° KÃ¢r ve Kredi DaÄŸÄ±tÄ±m SonuÃ§larÄ± (${NUM_YEARS_OF_ANALYSIS} YÄ±l Analiz, %5 BÃ¼yÃ¼me)</h2>
        <h3>Girdiler</h3>
        <ul>
            <li>**BaÅŸlangÄ±Ã§ YÄ±llÄ±k Net KÃ¢r:** ${initialAnnualNetProfit.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2 })}</li>
            <li>**YÄ±llÄ±k KÃ¢r BÃ¼yÃ¼me OranÄ±:** %${(ANNUAL_GROWTH_RATE * 100).toFixed(0)}</li>
            <li>**Analiz ve SatÄ±ÅŸ SÃ¼resi:** ${NUM_YEARS_OF_ANALYSIS} YÄ±l (${loanTermMonths} Ay)</li>
            <li>**SatÄ±ÅŸ Ã‡arpanÄ± (Exit Multiplier):** ${EXIT_MULTIPLIER}x Son YÄ±l EBITDA</li>
            <li>**Toplam Kredi TutarÄ±:** ${totalLoanPrincipal.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2 })}</li>
            <li>**AylÄ±k Kredi Taksiti:** ${monthlyLoanPayment.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2 })}</li>
        </ul>

        <table class="results-table">
            <thead>
                <tr>
                    <th rowspan="2">YÄ±l</th>
                    <th rowspan="2">YÄ±llÄ±k Toplam Kar</th>
                    <th colspan="3">1. Ortak (Ä°ÅŸleten, %50 MÃ¼lkiyet)</th>
                    <th colspan="3">2. Ortak (%25 MÃ¼lkiyet)</th>
                    <th colspan="3">3. Ortak (%25 MÃ¼lkiyet)</th>
                </tr>
                <tr>
                    <th>KÃ¢r PayÄ±</th>
                    <th class="loan">Kredi Ã–demesi (%50)</th>
                    <th>Net KazanÃ§</th>
                    <th>KÃ¢r PayÄ±</th>
                    <th class="loan">Kredi Ã–demesi (%25)</th>
                    <th>Net KazanÃ§</th>
                    <th>KÃ¢r PayÄ±</th>
                    <th class="loan">Kredi Ã–demesi (%25)</th>
                    <th>Net KazanÃ§</th>
                </tr>
            </thead>
            <tbody>
    `;

    let cumulativeP1Net = 0;
    let cumulativeP2Net = 0;
    let cumulativeP3Net = 0;
    let currentAnnualNetProfit = initialAnnualNetProfit;
    let cumulativeTotalProfit = 0;
    let finalYearEBITDA = 0; 
    
    for (let year = 1; year <= NUM_YEARS_OF_ANALYSIS; year++) {
        
        // YÄ±llÄ±k Kar ArtÄ±ÅŸÄ± Hesaplama
        if (year > 1) {
            currentAnnualNetProfit *= (1 + ANNUAL_GROWTH_RATE);
        }
        cumulativeTotalProfit += currentAnnualNetProfit;

        if (year === NUM_YEARS_OF_ANALYSIS) {
            finalYearEBITDA = currentAnnualNetProfit; // Son yÄ±l kÃ¢rÄ±nÄ± kaydet (SatÄ±ÅŸ iÃ§in kullanÄ±lacak)
        }
        
        // A. KÃ¢r DaÄŸÄ±tÄ±mÄ±
        const partner1DirectShare = currentAnnualNetProfit * OPERATOR_DIRECT_FRACTION;
        const remainingProfit = currentAnnualNetProfit - partner1DirectShare;
        const partner1RemainderShare = remainingProfit * REMAINDER_PARTNER_1_SHARE;
        const otherPartnersTotalRemainderShare = remainingProfit * REMAINDER_OTHER_PARTNERS_SHARE; 
        
        const P1_ANNUAL_PROFIT = partner1DirectShare + partner1RemainderShare;
        const P2_ANNUAL_PROFIT = otherPartnersTotalRemainderShare / 2;
        const P3_ANNUAL_PROFIT = otherPartnersTotalRemainderShare / 2;
        
        // B. Kredi SorumluluÄŸu DaÄŸÄ±tÄ±mÄ±
        let totalYearlyLoanPayment = 0;
        
        // Amortisman tablosundan yÄ±llÄ±k Ã¶demeyi al (amortizationSchedule'da index 1'den baÅŸladÄ±ÄŸÄ± iÃ§in direkt year kullanÄ±lÄ±r)
        const loanData = amortizationSchedule[year];
        if (loanData) {
            totalYearlyLoanPayment = loanData.totalPayment;
        }

        const P1_LOAN_SHARE = totalYearlyLoanPayment * PARTNER_1_OWNERSHIP;
        const P2_LOAN_SHARE = totalYearlyLoanPayment * PARTNER_2_OWNERSHIP;
        const P3_LOAN_SHARE = totalYearlyLoanPayment * PARTNER_3_OWNERSHIP;
        
        // C. Net KazanÃ§ (KÃ¢r PayÄ± - Kredi Ã–demesi)
        const P1_NET_CASH = P1_ANNUAL_PROFIT - P1_LOAN_SHARE;
        const P2_NET_CASH = P2_ANNUAL_PROFIT - P2_LOAN_SHARE;
        const P3_NET_CASH = P3_ANNUAL_PROFIT - P3_LOAN_SHARE;

        cumulativeP1Net += P1_NET_CASH;
        cumulativeP2Net += P2_NET_CASH;
        cumulativeP3Net += P3_NET_CASH;

        // Tablo SatÄ±rÄ±nÄ± Ekle
        htmlOutput += `
            <tr>
                <td>**${year}. YÄ±l**</td>
                <td>${currentAnnualNetProfit.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}</td>
                <td>${P1_ANNUAL_PROFIT.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}</td>
                <td class="loan">(${P1_LOAN_SHARE.toLocaleString('en-US', { style: 'currency', currency: 'USD' })})</td>
                <td class="net-cash-flow">${P1_NET_CASH.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}</td>
                <td>${P2_ANNUAL_PROFIT.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}</td>
                <td class="loan">(${P2_LOAN_SHARE.toLocaleString('en-US', { style: 'currency', currency: 'USD' })})</td>
                <td class="net-cash-flow">${P2_NET_CASH.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}</td>
                <td>${P3_ANNUAL_PROFIT.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}</td>
                <td class="loan">(${P3_LOAN_SHARE.toLocaleString('en-US', { style: 'currency', currency: 'USD' })})</td>
                <td class="net-cash-flow">${P3_NET_CASH.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}</td>
            </tr>
        `;
    }
    
    // 4. Ä°ÅŸletme SatÄ±ÅŸ HesaplamasÄ± (Dinamik SÃ¼renin Sonu)
    
    // Kredi Bakiyesi: Analiz sÃ¼resinin sonundaki bakiye.
    const finalLoanBalance = amortizationSchedule[NUM_YEARS_OF_ANALYSIS] ? amortizationSchedule[NUM_YEARS_OF_ANALYSIS].endingBalance : 0;
    
    const saleValue = finalYearEBITDA * EXIT_MULTIPLIER;
    const netSaleProceeds = saleValue - finalLoanBalance; 

    // SatÄ±ÅŸ Gelirinin MÃ¼lkiyet OranÄ±na GÃ¶re DaÄŸÄ±tÄ±mÄ±
    const P1_SALE_PROCEEDS = netSaleProceeds * PARTNER_1_OWNERSHIP;
    const P2_SALE_PROCEEDS = netSaleProceeds * PARTNER_2_OWNERSHIP;
    const P3_SALE_PROCEEDS = netSaleProceeds * PARTNER_3_OWNERSHIP;

    // Toplam KazanÃ§ (KÃ¼mÃ¼latif Net KÃ¢r + SatÄ±ÅŸ PayÄ±)
    const P1_GRAND_TOTAL = cumulativeP1Net + P1_SALE_PROCEEDS;
    const P2_GRAND_TOTAL = cumulativeP2Net + P2_SALE_PROCEEDS;
    const P3_GRAND_TOTAL = cumulativeP3Net + P3_SALE_PROCEEDS;

    htmlOutput += `
            </tbody>
            <tfoot>
                <tr>
                    <td>**${NUM_YEARS_OF_ANALYSIS} YILLIK KÃœMÃœLATÄ°F**</td>
                    <td>${cumulativeTotalProfit.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}</td>
                    <td colspan="2"></td>
                    <td class="net-cash-flow">${cumulativeP1Net.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}</td>
                    <td colspan="2"></td>
                    <td class="net-cash-flow">${cumulativeP2Net.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}</td>
                    <td colspan="2"></td>
                    <td class="net-cash-flow">${cumulativeP3Net.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}</td>
                </tr>
            </tfoot>
        </table>
        
        <br>
        <h2>ğŸ“Š ${NUM_YEARS_OF_ANALYSIS} YÄ±l Sonu SatÄ±ÅŸ ve Toplam KazanÃ§ HesaplamasÄ±</h2>
        <table class="results-table">
            <thead>
                <tr>
                    <th>SatÄ±ÅŸ DetayÄ±</th>
                    <th>Ortak 1 (%50)</th>
                    <th>Ortak 2 (%25)</th>
                    <th>Ortak 3 (%25)</th>
                    <th>Toplam</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>**Son YÄ±l EBITDA**</td>
                    <td colspan="3"></td>
                    <td>${finalYearEBITDA.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}</td>
                </tr>
                <tr>
                    <td>**Ä°ÅŸletme SatÄ±ÅŸ DeÄŸeri (3x)**</td>
                    <td colspan="3"></td>
                    <td>${saleValue.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}</td>
                </tr>
                <tr>
                    <td class="loan">Kalan Kredi Bakiyesi (SatÄ±ÅŸtan DÃ¼ÅŸÃ¼ldÃ¼)</td>
                    <td colspan="3"></td>
                    <td class="loan">(${finalLoanBalance.toLocaleString('en-US', { style: 'currency', currency: 'USD' })})</td>
                </tr>
                <tr>
                    <td>**Ortaklara DÃ¼kkan SatÄ±lÄ±rsa Gelecek Para **</td>
                    <td>${P1_SALE_PROCEEDS.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}</td>
                    <td>${P2_SALE_PROCEEDS.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}</td>
                    <td>${P3_SALE_PROCEEDS.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}</td>
                    <td>${netSaleProceeds.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}</td>
                </tr>
            </tbody>
            <tfoot>
                 <tr>
                    <td>**TOPLAM GRAND TOTAL (KÃ¢r + SatÄ±ÅŸ Geliri)**</td>
                    <td class="net-cash-flow">${P1_GRAND_TOTAL.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}</td>
                    <td class="net-cash-flow">${P2_GRAND_TOTAL.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}</td>
                    <td class="net-cash-flow">${P3_GRAND_TOTAL.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}</td>
                    <td>**${(P1_GRAND_TOTAL + P2_GRAND_TOTAL + P3_GRAND_TOTAL).toLocaleString('en-US', { style: 'currency', currency: 'USD' })}**</td>
                </tr>
            </tfoot>
        </table>
    `;

    document.getElementById('results').innerHTML = htmlOutput;
}
</script>
    
</body>
</html>
